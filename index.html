<html lang="zh"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>集团宣传册</title>
  <!-- 升级到最新稳定版pdf.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
      font-family: Arial, sans-serif;
    }
    #viewer {
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      text-align: center;
    }
    .loading {
      color: #666;
      padding: 40px 0;
    }
    .error {
      color: #dc3545;
      padding: 40px 0;
    }
    canvas {
      width: 100%;
      margin-bottom: 10px;
      background: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <div id="viewer">
    <!-- 增加加载状态提示 -->
    <div class="loading">正在加载PDF文件，请稍候...</div>
  </div>
  <script>
    // PDF文件路径 - 建议使用完整URL以避免路径问题
    const url = "ttpdf.pdf"; 
    const viewer = document.getElementById('viewer');

    // 确保pdfjsLib正确加载
    if (typeof pdfjsLib === 'undefined') {
      viewer.innerHTML = '<div class="error">PDF查看器加载失败，请刷新页面重试</div>';
    } else {
      // 配置pdf.js的工作器
      pdfjsLib.GlobalWorkerOptions.workerSrc = 
        'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

      // 加载并渲染PDF
      pdfjsLib.getDocument(url).promise
        .then(pdf => {
          // 清除加载提示
          viewer.innerHTML = '';
          
          // 显示总页数信息
          const pageInfo = document.createElement('p');
          pageInfo.textContent = `共 ${pdf.numPages} 页`;
          pageInfo.style.color = '#666';
          viewer.appendChild(pageInfo);
          
          // 降低缩放比例到1.0，减少内存占用
          const scale = 1.0;
          
          // 逐页渲染
          for (let i = 1; i <= pdf.numPages; i++) {
            pdf.getPage(i)
              .then(page => {
                const viewport = page.getViewport({ scale });
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                
                // 设置canvas尺寸
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                canvas.title = `第 ${i} 页`;
                
                // 添加到页面
                viewer.appendChild(canvas);
                
                // 渲染页面
                const renderContext = {
                  canvasContext: context,
                  viewport: viewport
                };
                
                return page.render(renderContext).promise;
              })
              .catch(err => {
                console.error(`第${i}页渲染失败:`, err);
                const errorEl = document.createElement('div');
                errorEl.className = 'error';
                errorEl.textContent = `第${i}页加载失败`;
                viewer.appendChild(errorEl);
              });
          }
        })
        .catch(err => {
          console.error('PDF文件加载失败:', err);
          // 显示具体错误信息
          let errorMessage = 'PDF文件加载失败，请检查网络连接或文件是否存在';
          
          // 根据错误类型提供更具体的提示
          if (err.name === 'MissingPDFException') {
            errorMessage = '未找到PDF文件，请确认文件路径是否正确';
          } else if (err.name === 'InvalidPDFException') {
            errorMessage = 'PDF文件损坏或格式不正确';
          } else if (err.message.includes('CORS')) {
            errorMessage = '跨域访问被阻止，请检查服务器配置';
          }
          
          viewer.innerHTML = `<div class="error">${errorMessage}</div>`;
        });
    }
  </script>


</body></html>
